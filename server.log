
> stock-mind@0.1.0 dev
> next dev --turbopack

 ⚠ Invalid next.config.ts options detected: 
 ⚠     Unrecognized key(s) in object: 'serverComponentsExternalPackages' at "experimental"
 ⚠     Unrecognized key(s) in object: 'api'
 ⚠ See more info here: https://nextjs.org/docs/messages/invalid-next-config
 ⚠ `experimental.serverComponentsExternalPackages` has been moved to `serverExternalPackages`. Please update your next.config.ts file accordingly.
   ▲ Next.js 15.5.3 (Turbopack)
   - Local:        http://localhost:3000
   - Network:      http://10.0.0.235:3000
   - Environments: .env.local, .env
   - Experiments (use with caution):
     · serverComponentsExternalPackages

 ✓ Starting...
 ✓ Compiled middleware in 84ms
 ✓ Ready in 849ms
 ○ Compiling /api/auth/login ...
 ✓ Compiled /api/auth/login in 674ms
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 1075ms
 ✓ Compiled /api/products/[id] in 76ms
Product update request for ID: cmfxyus250001y7xp90f7vztj
Received images: undefined
Received videos: undefined
Received thumbnailUrl: undefined
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
Received update data: {
  images: undefined,
  videos: undefined,
  thumbnailUrl: undefined,
  imagesCount: 0,
  videosCount: 0,
  imagesDetails: [],
  videosDetails: []
}
Update data after filtering: {
  categoryIds: undefined,
  clientId: undefined,
  restUpdateDataKeys: [ 'name', 'sku', 'description', 'price', 'cost', 'updatedAt' ],
  restUpdateData: {
    name: 'Test Product for E2E - UPDATED',
    sku: 'TEST-E2E-001',
    description: 'Updated test product for end-to-end testing',
    price: 149.99,
    cost: 75,
    updatedAt: 2025-09-24T12:37:06.875Z
  }
}
prisma:error 
Invalid `__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].product.update()` invocation in
/Users/karthiknaidudintakurthi/Documents/GitHub/catalog-app/.next/server/chunks/[root-of-the-server]__5940f446._.js:581:172

  578     restUpdateDataKeys: Object.keys(restUpdateData),
  579     restUpdateData
  580 });
→ 581 const product = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].product.update({
        where: {
          id: "cmfxyus250001y7xp90f7vztj"
        },
        data: {
          name: "Test Product for E2E - UPDATED",
          sku: "TEST-E2E-001",
          description: "Updated test product for end-to-end testing",
          price: 149.99,
          cost: 75,
          ~~~~
          updatedAt: new Date("2025-09-24T12:37:06.875Z"),
          categories: {
            deleteMany: {},
            create: [
              {
                categoryId: "test-category-1"
              }
            ]
          },
      ?   id?: String | StringFieldUpdateOperationsInput,
      ?   category?: String | StringFieldUpdateOperationsInput,
      ?   categoryId?: String | NullableStringFieldUpdateOperationsInput | Null,
      ?   variations?: NullableJsonNullValueInput | Json,
      ?   stockLevel?: Int | IntFieldUpdateOperationsInput,
      ?   minStock?: Int | IntFieldUpdateOperationsInput,
      ?   isActive?: Boolean | BoolFieldUpdateOperationsInput,
      ?   media?: NullableJsonNullValueInput | Json,
      ?   images?: NullableJsonNullValueInput | Json,
      ?   videos?: NullableJsonNullValueInput | Json,
      ?   thumbnailUrl?: String | NullableStringFieldUpdateOperationsInput | Null,
      ?   createdAt?: DateTime | DateTimeFieldUpdateOperationsInput,
      ?   client?: ClientUpdateOneRequiredWithoutProductsNestedInput,
      ?   inventoryHistory?: InventoryHistoryUpdateManyWithoutProductNestedInput,
      ?   mediaItems?: MediaUpdateManyWithoutProductNestedInput
        },
        include: {
          categories: {
            include: {
              category: {
                select: {
                  id: true,
                  name: true,
                  description: true,
                  parentId: true
                }
              }
            }
          },
          inventoryHistory: {
            take: 5,
            orderBy: {
              createdAt: "desc"
            },
            include: {
              user: {
                select: {
                  name: true,
                  email: true
                }
              }
            }
          },
          mediaItems: {
            select: {
              id: true,
              kind: true,
              s3Key: true,
              width: true,
              height: true,
              durationMs: true,
              status: true,
              error: true,
              createdAt: true,
              updatedAt: true
            }
          }
        }
      })

Unknown argument `cost`. Available options are marked with ?.
Database error: Error [PrismaClientValidationError]: 
Invalid `__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].product.update()` invocation in
/Users/karthiknaidudintakurthi/Documents/GitHub/catalog-app/.next/server/chunks/[root-of-the-server]__5940f446._.js:581:172

  578     restUpdateDataKeys: Object.keys(restUpdateData),
  579     restUpdateData
  580 });
→ 581 const product = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].product.update({
        where: {
          id: "cmfxyus250001y7xp90f7vztj"
        },
        data: {
          name: "Test Product for E2E - UPDATED",
          sku: "TEST-E2E-001",
          description: "Updated test product for end-to-end testing",
          price: 149.99,
          cost: 75,
          ~~~~
          updatedAt: new Date("2025-09-24T12:37:06.875Z"),
          categories: {
            deleteMany: {},
            create: [
              {
                categoryId: "test-category-1"
              }
            ]
          },
      ?   id?: String | StringFieldUpdateOperationsInput,
      ?   category?: String | StringFieldUpdateOperationsInput,
      ?   categoryId?: String | NullableStringFieldUpdateOperationsInput | Null,
      ?   variations?: NullableJsonNullValueInput | Json,
      ?   stockLevel?: Int | IntFieldUpdateOperationsInput,
      ?   minStock?: Int | IntFieldUpdateOperationsInput,
      ?   isActive?: Boolean | BoolFieldUpdateOperationsInput,
      ?   media?: NullableJsonNullValueInput | Json,
      ?   images?: NullableJsonNullValueInput | Json,
      ?   videos?: NullableJsonNullValueInput | Json,
      ?   thumbnailUrl?: String | NullableStringFieldUpdateOperationsInput | Null,
      ?   createdAt?: DateTime | DateTimeFieldUpdateOperationsInput,
      ?   client?: ClientUpdateOneRequiredWithoutProductsNestedInput,
      ?   inventoryHistory?: InventoryHistoryUpdateManyWithoutProductNestedInput,
      ?   mediaItems?: MediaUpdateManyWithoutProductNestedInput
        },
        include: {
          categories: {
            include: {
              category: {
                select: {
                  id: true,
                  name: true,
                  description: true,
                  parentId: true
                }
              }
            }
          },
          inventoryHistory: {
            take: 5,
            orderBy: {
              createdAt: "desc"
            },
            include: {
              user: {
                select: {
                  name: true,
                  email: true
                }
              }
            }
          },
          mediaItems: {
            select: {
              id: true,
              kind: true,
              s3Key: true,
              width: true,
              height: true,
              durationMs: true,
              status: true,
              error: true,
              createdAt: true,
              updatedAt: true
            }
          }
        }
      })

Unknown argument `cost`. Available options are marked with ?.
    at <unknown> (src/app/api/products/[id]/route.ts:205:44)
    at async PUT (src/app/api/products/[id]/route.ts:205:23)
  203 |       })
  204 |
> 205 |       const product = await prisma.product.update({
      |                                            ^
  206 |         where: { id },
  207 |         data: {
  208 |           ...restUpdateData, {
  clientVersion: '6.16.2'
}
 PUT /api/products/cmfxyus250001y7xp90f7vztj 500 in 886ms
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 293ms
Product update request for ID: cmfxyus250001y7xp90f7vztj
Received images: undefined
Received videos: undefined
Received thumbnailUrl: undefined
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
Received update data: {
  images: undefined,
  videos: undefined,
  thumbnailUrl: undefined,
  imagesCount: 0,
  videosCount: 0,
  imagesDetails: [],
  videosDetails: []
}
Update data after filtering: {
  categoryIds: undefined,
  clientId: undefined,
  restUpdateDataKeys: [ 'name', 'sku', 'description', 'price', 'updatedAt' ],
  restUpdateData: {
    name: 'Test Product for E2E - UPDATED',
    sku: 'TEST-E2E-001',
    description: 'Updated test product for end-to-end testing',
    price: 149.99,
    updatedAt: 2025-09-24T12:37:15.574Z
  }
}
prisma:query BEGIN
prisma:query UPDATE "public"."products" SET "name" = $1, "sku" = $2, "description" = $3, "price" = $4, "updatedAt" = $5 WHERE ("public"."products"."id" = $6 AND 1=1) RETURNING "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt"
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId" FROM "public"."product_categories" WHERE (1=1 AND "public"."product_categories"."productId" IN ($1)) OFFSET $2
prisma:query INSERT INTO "public"."product_categories" ("id","productId","categoryId","createdAt") VALUES ($1,$2,$3,$4) RETURNING "public"."product_categories"."id"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE "public"."products"."id" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC LIMIT $2 OFFSET $3
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query COMMIT
Product updated successfully: {
  id: 'cmfxyus250001y7xp90f7vztj',
  imagesCount: 0,
  videosCount: 0,
  thumbnailUrl: null,
  imagesDetails: [],
  videosDetails: []
}
 PUT /api/products/cmfxyus250001y7xp90f7vztj 200 in 242ms
prisma:query SELECT 1
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 291ms
 ✓ Compiled /api/upload-presigned in 187ms
 POST /api/upload-presigned 400 in 488ms
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 291ms
 POST /api/upload-presigned 200 in 238ms
prisma:query SELECT 1
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 303ms
 ✓ Compiled /api/save-media in 79ms
 POST /api/save-media 400 in 312ms
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 292ms
prisma:query SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."sku" = $1 AND "public"."products"."clientId" = $2) LIMIT $3 OFFSET $4
prisma:error 
Invalid `__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].media.create()` invocation in
/Users/karthiknaidudintakurthi/Documents/GitHub/catalog-app/.next/server/chunks/[root-of-the-server]__0c8d3ee4._.js:182:164

  179     });
  180 }
  181 // Save media to database
→ 182 const media = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].media.create({
        data: {
          productId: "cmfxyus250001y7xp90f7vztj",
          kind: "video",
          s3Key: "clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4",
          width: 0,
          height: 0,
          status: "completed",
          clientId: "cmfohvqxb0001jp04hqvisj49",
          ~~~~~~~~
      ?   id?: String,
      ?   durationMs?: Int | Null,
      ?   error?: String | Null,
      ?   createdAt?: DateTime,
      ?   updatedAt?: DateTime
        }
      })

Unknown argument `clientId`. Available options are marked with ?.
Error saving media: Error [PrismaClientValidationError]: 
Invalid `__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].media.create()` invocation in
/Users/karthiknaidudintakurthi/Documents/GitHub/catalog-app/.next/server/chunks/[root-of-the-server]__0c8d3ee4._.js:182:164

  179     });
  180 }
  181 // Save media to database
→ 182 const media = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].media.create({
        data: {
          productId: "cmfxyus250001y7xp90f7vztj",
          kind: "video",
          s3Key: "clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4",
          width: 0,
          height: 0,
          status: "completed",
          clientId: "cmfohvqxb0001jp04hqvisj49",
          ~~~~~~~~
      ?   id?: String,
      ?   durationMs?: Int | Null,
      ?   error?: String | Null,
      ?   createdAt?: DateTime,
      ?   updatedAt?: DateTime
        }
      })

Unknown argument `clientId`. Available options are marked with ?.
    at <unknown> (src/app/api/save-media/route.ts:65:38)
    at async POST (src/app/api/save-media/route.ts:65:19)
  63 |
  64 |     // Save media to database
> 65 |     const media = await prisma.media.create({
     |                                      ^
  66 |       data: {
  67 |         productId: product.id,
  68 |         kind: kind as 'image' | 'video', {
  clientVersion: '6.16.2'
}
 POST /api/save-media 500 in 349ms
prisma:query SELECT 1
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 297ms
prisma:query SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."sku" = $1 AND "public"."products"."clientId" = $2) LIMIT $3 OFFSET $4
prisma:query INSERT INTO "public"."media" ("id","productId","kind","s3Key","width","height","status","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9) RETURNING "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt"
 POST /api/save-media 200 in 269ms
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 318ms
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $2
 GET /api/products/cmfxyus250001y7xp90f7vztj 200 in 239ms
prisma:query SELECT 1
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 301ms
 ✓ Compiled /api/generate-thumbnail in 97ms
 POST /api/generate-thumbnail 400 in 524ms
prisma:query SELECT 1
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 298ms
prisma:query SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."sku" = $1 AND "public"."products"."clientId" = $2) LIMIT $3 OFFSET $4
Thumbnail generation error: Error: Failed to download video: Forbidden
    at POST (src/app/api/generate-thumbnail/route.ts:72:15)
  70 |       
  71 |       if (!videoResponse.ok) {
> 72 |         throw new Error(`Failed to download video: ${videoResponse.statusText}`)
     |               ^
  73 |       }
  74 |
  75 |       const videoBuffer = Buffer.from(await videoResponse.arrayBuffer())
 POST /api/generate-thumbnail 500 in 501ms
prisma:query SELECT 1
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 302ms
 ✓ Compiled /api/products in 96ms
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."sku" = $1 AND "public"."products"."clientId" = $2) LIMIT $3 OFFSET $4
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."isActive", "public"."categories"."clientId", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."updatedAt" FROM "public"."categories" WHERE ("public"."categories"."id" = $1 AND "public"."categories"."clientId" = $2) LIMIT $3 OFFSET $4
prisma:query BEGIN
prisma:query INSERT INTO "public"."products" ("id","name","sku","description","price","category","categoryId","variations","stockLevel","minStock","isActive","clientId","images","videos","thumbnailUrl","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17) RETURNING "public"."products"."id"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE "public"."products"."id" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC LIMIT $2 OFFSET $3
prisma:query COMMIT
 POST /api/products 201 in 338ms
prisma:query SELECT 1
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 298ms
Product update request for ID: cmfxz3ql30007y7o5p5h8ekuv
Received images: undefined
Received videos: undefined
Received thumbnailUrl: undefined
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
Received update data: {
  images: undefined,
  videos: undefined,
  thumbnailUrl: undefined,
  imagesCount: 0,
  videosCount: 0,
  imagesDetails: [],
  videosDetails: []
}
Update data after filtering: {
  categoryIds: undefined,
  clientId: undefined,
  restUpdateDataKeys: [ 'name', 'sku', 'description', 'price', 'updatedAt' ],
  restUpdateData: {
    name: 'Schema Test Product - UPDATED',
    sku: 'SCHEMA-TEST-001',
    description: 'Updated schema consistency test',
    price: 249.99,
    updatedAt: 2025-09-24T12:41:46.107Z
  }
}
prisma:query BEGIN
prisma:query UPDATE "public"."products" SET "name" = $1, "sku" = $2, "description" = $3, "price" = $4, "updatedAt" = $5 WHERE ("public"."products"."id" = $6 AND 1=1) RETURNING "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt"
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId" FROM "public"."product_categories" WHERE (1=1 AND "public"."product_categories"."productId" IN ($1)) OFFSET $2
prisma:query INSERT INTO "public"."product_categories" ("id","productId","categoryId","createdAt") VALUES ($1,$2,$3,$4) RETURNING "public"."product_categories"."id"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE "public"."products"."id" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC LIMIT $2 OFFSET $3
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query COMMIT
Product updated successfully: {
  id: 'cmfxz3ql30007y7o5p5h8ekuv',
  imagesCount: 0,
  videosCount: 0,
  thumbnailUrl: null,
  imagesDetails: [],
  videosDetails: []
}
 PUT /api/products/cmfxz3ql30007y7o5p5h8ekuv 200 in 276ms
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 297ms
 POST /api/upload-presigned 200 in 244ms
prisma:query SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."sku" = $1 AND "public"."products"."clientId" = $2) LIMIT $3 OFFSET $4
prisma:query INSERT INTO "public"."media" ("id","productId","kind","s3Key","width","height","status","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9) RETURNING "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt"
 POST /api/save-media 200 in 274ms
prisma:query SELECT 1
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 306ms
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $2
 GET /api/products/cmfxz3ql30007y7o5p5h8ekuv 200 in 238ms
prisma:query SELECT 1
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 302ms
Product update request for ID: cmfxz3ql30007y7o5p5h8ekuv
Received images: [
  {
    id: 'test-image-1',
    url: 'https://example.com/test-image.jpg',
    key: 'test-image-key',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Received videos: undefined
Received thumbnailUrl: undefined
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
Received update data: {
  images: [
    {
      id: 'test-image-1',
      url: 'https://example.com/test-image.jpg',
      key: 'test-image-key',
      fileName: 'test-image.jpg',
      fileSize: 1024,
      fileType: 'image/jpeg',
      uploadedAt: '2025-09-24T12:41:00.000Z'
    }
  ],
  videos: undefined,
  thumbnailUrl: undefined,
  imagesCount: 1,
  videosCount: 0,
  imagesDetails: [ { fileName: 'test-image.jpg', hasUrl: true, hasKey: true } ],
  videosDetails: []
}
Update data after filtering: {
  categoryIds: undefined,
  clientId: undefined,
  restUpdateDataKeys: [ 'name', 'sku', 'description', 'price', 'images', 'updatedAt' ],
  restUpdateData: {
    name: 'Schema Test Product - WITH MEDIA',
    sku: 'SCHEMA-TEST-001',
    description: 'Updated with media consistency test',
    price: 299.99,
    images: [ [Object] ],
    updatedAt: 2025-09-24T12:42:49.606Z
  }
}
prisma:query BEGIN
prisma:query UPDATE "public"."products" SET "name" = $1, "sku" = $2, "description" = $3, "price" = $4, "images" = $5, "updatedAt" = $6 WHERE ("public"."products"."id" = $7 AND 1=1) RETURNING "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt"
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId" FROM "public"."product_categories" WHERE (1=1 AND "public"."product_categories"."productId" IN ($1)) OFFSET $2
prisma:query DELETE FROM "public"."product_categories" WHERE ("public"."product_categories"."id" IN ($1) AND 1=1)
prisma:query INSERT INTO "public"."product_categories" ("id","productId","categoryId","createdAt") VALUES ($1,$2,$3,$4) RETURNING "public"."product_categories"."id"
prisma:query SELECT "public"."media"."id", "public"."media"."productId" FROM "public"."media" WHERE (1=1 AND "public"."media"."productId" IN ($1)) OFFSET $2
prisma:query DELETE FROM "public"."media" WHERE ("public"."media"."id" IN ($1) AND 1=1)
prisma:query INSERT INTO "public"."media" ("id","productId","kind","s3Key","width","height","status","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9) RETURNING "public"."media"."id"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE "public"."products"."id" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC LIMIT $2 OFFSET $3
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query COMMIT
Product updated successfully: {
  id: 'cmfxz3ql30007y7o5p5h8ekuv',
  imagesCount: 1,
  videosCount: 0,
  thumbnailUrl: null,
  imagesDetails: [ { fileName: 'test-image.jpg', hasUrl: true, hasKey: true } ],
  videosDetails: []
}
Processing 1 media items for embedding
Processing 1 images for embedding
Processing image for embedding: mediaId=cmfxz5g1z000ey7o5yunkv14r, url=https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key
No videos to process for embedding
 PUT /api/products/cmfxz3ql30007y7o5p5h8ekuv 200 in 245ms
prisma:query UPDATE "public"."media" SET "status" = $1, "updatedAt" = $2 WHERE ("public"."media"."id" = $3 AND 1=1) RETURNING "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt"
Error generating image embedding: Error: Failed to fetch image: Forbidden
    at generateImageEmbedding (src/lib/embeddings.ts:21:13)
    at async processImageForEmbedding (src/lib/embeddings.ts:101:27)
    at async (src/lib/embeddings.ts:229:11)
    at async processImagesForEmbedding (src/lib/embeddings.ts:224:5)
    at async processMediaForEmbedding (src/lib/embeddings.ts:276:3)
  19 |     const imageResponse = await fetch(imageUrl)
  20 |     if (!imageResponse.ok) {
> 21 |       throw new Error(`Failed to fetch image: ${imageResponse.statusText}`)
     |             ^
  22 |     }
  23 |     
  24 |     const imageBuffer = await imageResponse.arrayBuffer()
Error processing image embedding for mediaId cmfxz5g1z000ey7o5yunkv14r: Error: Failed to fetch image: Forbidden
    at generateImageEmbedding (src/lib/embeddings.ts:21:13)
    at async processImageForEmbedding (src/lib/embeddings.ts:101:27)
    at async (src/lib/embeddings.ts:229:11)
    at async processImagesForEmbedding (src/lib/embeddings.ts:224:5)
    at async processMediaForEmbedding (src/lib/embeddings.ts:276:3)
  19 |     const imageResponse = await fetch(imageUrl)
  20 |     if (!imageResponse.ok) {
> 21 |       throw new Error(`Failed to fetch image: ${imageResponse.statusText}`)
     |             ^
  22 |     }
  23 |     
  24 |     const imageBuffer = await imageResponse.arrayBuffer()
prisma:query UPDATE "public"."media" SET "status" = $1, "error" = $2, "updatedAt" = $3 WHERE ("public"."media"."id" = $4 AND 1=1) RETURNING "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt"
Failed to process image cmfxz5g1z000ey7o5yunkv14r: Error: Failed to fetch image: Forbidden
    at generateImageEmbedding (src/lib/embeddings.ts:21:13)
    at async processImageForEmbedding (src/lib/embeddings.ts:101:27)
    at async (src/lib/embeddings.ts:229:11)
    at async processImagesForEmbedding (src/lib/embeddings.ts:224:5)
    at async processMediaForEmbedding (src/lib/embeddings.ts:276:3)
  19 |     const imageResponse = await fetch(imageUrl)
  20 |     if (!imageResponse.ok) {
> 21 |       throw new Error(`Failed to fetch image: ${imageResponse.statusText}`)
     |             ^
  22 |     }
  23 |     
  24 |     const imageBuffer = await imageResponse.arrayBuffer()
Completed processing 1 images for embedding
Completed processing all media items for embedding
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 303ms
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $2
 GET /api/products/cmfxz3ql30007y7o5p5h8ekuv 200 in 253ms
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 315ms
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
Fetching media for product IDs: [
  'prod_jwl_003',
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_003',
    sku: 'JWL-003',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: false,
  hasLegacyImages: true,
  mediaCount: 0,
  legacyImageCount: 1
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products 200 in 252ms
prisma:query SELECT 1
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 304ms
prisma:query SELECT 1
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_003',
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_003',
    sku: 'JWL-003',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T130408Z&X-Amz-Expires=604800&X-Amz-Signature=7e018df464d3106379d766f6d401c4485aa924009dd7d34ad202fb69262ed63d&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T130408Z&X-Amz-Expires=604800&X-Amz-Signature=b5b22aca5ca68c98e72b3900cc8e6e653b49d2c22f9619e408a6c0b143629e23&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products 200 in 297ms
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 306ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_003',
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_003',
    sku: 'JWL-003',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T130419Z&X-Amz-Expires=604800&X-Amz-Signature=bfee31b4c73abc0ccaf1acdf73bc11c572a46aa7c11f607363ae9431fc8e015f&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T130419Z&X-Amz-Expires=604800&X-Amz-Signature=774307308e15f6e9f6cd9ce2edbd8f856bbad6fc70427c5a18a3f2d77d35c953&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products 200 in 245ms
prisma:query SELECT 1
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 305ms
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $2
 GET /api/products/cmfxz3ql30007y7o5p5h8ekuv 200 in 240ms
 ○ Compiling /products/[id] ...
 ✓ Compiled /products/[id] in 2.1s
 GET /products/cmfxz3ql30007y7o5p5h8ekuv 200 in 2592ms
 ✓ Compiled /products/new in 388ms
 GET /products/new 200 in 474ms
 ✓ Compiled /_not-found/page in 143ms
 GET /api/health 404 in 203ms
 ✓ Compiled / in 228ms
 GET / 200 in 286ms
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 321ms
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 313ms
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_003',
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_003',
    sku: 'JWL-003',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T130948Z&X-Amz-Expires=604800&X-Amz-Signature=be3373f9730b9ee00cf82129202d29580ed57db06c12da6c4119bb5f433b0071&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T130948Z&X-Amz-Expires=604800&X-Amz-Signature=8f0d89a75693a4599d65f2d6b3c3d99f47c7679eff6b8bec9fde3ac89c8245bc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products 200 in 304ms
 GET / 200 in 55ms
 ○ Compiling /products ...
 ✓ Compiled /products in 647ms
 GET /products 200 in 738ms
 GET /products/new 200 in 71ms
prisma:query SELECT 1
prisma:query SELECT "public"."users"."id", "public"."users"."email", "public"."users"."password", "public"."users"."name", "public"."users"."role"::text, "public"."users"."clientId", "public"."users"."isActive", "public"."users"."createdAt", "public"."users"."updatedAt" FROM "public"."users" WHERE "public"."users"."email" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."isActive", "public"."clients"."plan"::text FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 POST /api/auth/login 200 in 305ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_003',
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_003',
    sku: 'JWL-003',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131002Z&X-Amz-Expires=604800&X-Amz-Signature=b663bf6786c102b3f8c28ead25266a2ea0c32ad2d82980cdfde137b83ef6b784&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131002Z&X-Amz-Expires=604800&X-Amz-Signature=3c59760292ac72b533f1cbf6745b2596df9ddd778edd7822c0897b92ec876ed5&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products 200 in 246ms
Product update request for ID: prod_jwl_003
Received images: undefined
Received videos: undefined
Received thumbnailUrl: undefined
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
Received update data: {
  images: undefined,
  videos: undefined,
  thumbnailUrl: undefined,
  imagesCount: 0,
  videosCount: 0,
  imagesDetails: [],
  videosDetails: []
}
Update data after filtering: {
  categoryIds: undefined,
  clientId: undefined,
  restUpdateDataKeys: [ 'name', 'description', 'updatedAt' ],
  restUpdateData: {
    name: 'Updated Product Name',
    description: 'Updated description',
    updatedAt: 2025-09-24T13:10:03.021Z
  }
}
prisma:query BEGIN
prisma:query UPDATE "public"."products" SET "name" = $1, "description" = $2, "updatedAt" = $3 WHERE ("public"."products"."id" = $4 AND 1=1) RETURNING "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE "public"."products"."id" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC LIMIT $2 OFFSET $3
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query COMMIT
Product updated successfully: {
  id: 'prod_jwl_003',
  imagesCount: 0,
  videosCount: 0,
  thumbnailUrl: 'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400&h=400&fit=crop&crop=center',
  imagesDetails: [],
  videosDetails: []
}
 PUT /api/products/prod_jwl_003 200 in 300ms
 GET / 200 in 70ms
 ✓ Compiled /api/settings in 167ms
prisma:query SELECT 1
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT 1
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."stockLevel" <= "public"."products"."minStock") OFFSET $2) AS "sub"
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 GET /api/settings 200 in 442ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."categories"."id" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."users"."id" FROM "public"."users" WHERE "public"."users"."clientId" = $1 OFFSET $2) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."price", "public"."products"."stockLevel" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."inventory_history"."id" FROM "public"."inventory_history" WHERE ("public"."inventory_history"."clientId" = $1 AND "public"."inventory_history"."createdAt" >= $2) OFFSET $3) AS "sub"
 GET /api/stats 200 in 448ms
 GET / 200 in 84ms
 ✓ Compiled /favicon.ico in 89ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 GET /api/settings 200 in 277ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."stockLevel" <= "public"."products"."minStock") OFFSET $2) AS "sub"
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."categories"."id" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."users"."id" FROM "public"."users" WHERE "public"."users"."clientId" = $1 OFFSET $2) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."price", "public"."products"."stockLevel" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."inventory_history"."id" FROM "public"."inventory_history" WHERE ("public"."inventory_history"."clientId" = $1 AND "public"."inventory_history"."createdAt" >= $2) OFFSET $3) AS "sub"
 GET /api/stats 200 in 281ms
 GET /favicon.ico?favicon.0b3bf435.ico 200 in 342ms
 GET /sw.js 404 in 104ms
 GET /products 200 in 65ms
 ✓ Compiled /api/categories in 77ms
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 GET /api/settings 200 in 289ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131119Z&X-Amz-Expires=604800&X-Amz-Signature=894e9a7ae5b35fd7ac49b2f90af6f5aa26d151322a5da05d6de321eba997b665&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131119Z&X-Amz-Expires=604800&X-Amz-Signature=17a11e683418e873eac882c87dc39d65d7c4703bae081fad473ce292e522ab86&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 282ms
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2 AND "public"."categories"."parentId" IS NULL) ORDER BY "public"."categories"."parentId" ASC, "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."isActive" = $1 AND "public"."categories"."parentId" IN ($2)) ORDER BY "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
 GET /api/categories 200 in 331ms
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
 GET /api/settings 200 in 340ms
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131119Z&X-Amz-Expires=604800&X-Amz-Signature=894e9a7ae5b35fd7ac49b2f90af6f5aa26d151322a5da05d6de321eba997b665&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131119Z&X-Amz-Expires=604800&X-Amz-Signature=17a11e683418e873eac882c87dc39d65d7c4703bae081fad473ce292e522ab86&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 340ms
 GET /api/categories 200 in 306ms
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2 AND "public"."categories"."parentId" IS NULL) ORDER BY "public"."categories"."parentId" ASC, "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."isActive" = $1 AND "public"."categories"."parentId" IN ($2)) ORDER BY "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131119Z&X-Amz-Expires=604800&X-Amz-Signature=894e9a7ae5b35fd7ac49b2f90af6f5aa26d151322a5da05d6de321eba997b665&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131119Z&X-Amz-Expires=604800&X-Amz-Signature=17a11e683418e873eac882c87dc39d65d7c4703bae081fad473ce292e522ab86&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 248ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131120Z&X-Amz-Expires=604800&X-Amz-Signature=95bc5f698fee3775b1fa5169d6009d1229ba9f9d1d051adaf342a216e841b86c&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131120Z&X-Amz-Expires=604800&X-Amz-Signature=df68e5ba86e77ea53f7f752ad04985c24138a6c4d36f0ff6bcdc89124cb1db32&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 247ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131120Z&X-Amz-Expires=604800&X-Amz-Signature=95bc5f698fee3775b1fa5169d6009d1229ba9f9d1d051adaf342a216e841b86c&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131120Z&X-Amz-Expires=604800&X-Amz-Signature=df68e5ba86e77ea53f7f752ad04985c24138a6c4d36f0ff6bcdc89124cb1db32&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 268ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131120Z&X-Amz-Expires=604800&X-Amz-Signature=95bc5f698fee3775b1fa5169d6009d1229ba9f9d1d051adaf342a216e841b86c&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131120Z&X-Amz-Expires=604800&X-Amz-Signature=df68e5ba86e77ea53f7f752ad04985c24138a6c4d36f0ff6bcdc89124cb1db32&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 258ms
 ✓ Compiled /products/[id]/edit in 307ms
 GET /products/prod_jwl_001/edit 200 in 609ms
prisma:query SELECT 1
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2 AND "public"."categories"."parentId" IS NULL) ORDER BY "public"."categories"."parentId" ASC, "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."isActive" = $1 AND "public"."categories"."parentId" IN ($2)) ORDER BY "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 GET /api/categories 200 in 296ms
 GET /api/settings 200 in 285ms
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $2
 GET /api/products/prod_jwl_001 200 in 282ms
 GET /products 200 in 57ms
prisma:query SELECT 1
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
 GET /api/settings 200 in 270ms
 GET /api/categories 200 in 273ms
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2 AND "public"."categories"."parentId" IS NULL) ORDER BY "public"."categories"."parentId" ASC, "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."isActive" = $1 AND "public"."categories"."parentId" IN ($2)) ORDER BY "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131143Z&X-Amz-Expires=604800&X-Amz-Signature=7b83121f40f92b035c86361ec481bb0877e3744d6f9d79d32ba19a1362418312&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131143Z&X-Amz-Expires=604800&X-Amz-Signature=3ece863154e5be33838575ca32266eb6489b2b3771913fb19b396f2ef3bfde81&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 286ms
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2 AND "public"."categories"."parentId" IS NULL) ORDER BY "public"."categories"."parentId" ASC, "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."isActive" = $1 AND "public"."categories"."parentId" IN ($2)) ORDER BY "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 GET /api/categories 200 in 283ms
 GET /api/settings 200 in 286ms
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131143Z&X-Amz-Expires=604800&X-Amz-Signature=7b83121f40f92b035c86361ec481bb0877e3744d6f9d79d32ba19a1362418312&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131143Z&X-Amz-Expires=604800&X-Amz-Signature=3ece863154e5be33838575ca32266eb6489b2b3771913fb19b396f2ef3bfde81&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 298ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131143Z&X-Amz-Expires=604800&X-Amz-Signature=7b83121f40f92b035c86361ec481bb0877e3744d6f9d79d32ba19a1362418312&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131143Z&X-Amz-Expires=604800&X-Amz-Signature=3ece863154e5be33838575ca32266eb6489b2b3771913fb19b396f2ef3bfde81&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 253ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131144Z&X-Amz-Expires=604800&X-Amz-Signature=4d68c00fda0db778e2d3f1005f1f5b539ebd826a79d8c844ba1b986257dc40d7&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131144Z&X-Amz-Expires=604800&X-Amz-Signature=a4d5acad63ded362717336a893dd31bc3b72d521d04fd74053a6feb4f0395a99&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 257ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131144Z&X-Amz-Expires=604800&X-Amz-Signature=4d68c00fda0db778e2d3f1005f1f5b539ebd826a79d8c844ba1b986257dc40d7&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131144Z&X-Amz-Expires=604800&X-Amz-Signature=a4d5acad63ded362717336a893dd31bc3b72d521d04fd74053a6feb4f0395a99&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 251ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131144Z&X-Amz-Expires=604800&X-Amz-Signature=4d68c00fda0db778e2d3f1005f1f5b539ebd826a79d8c844ba1b986257dc40d7&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131144Z&X-Amz-Expires=604800&X-Amz-Signature=a4d5acad63ded362717336a893dd31bc3b72d521d04fd74053a6feb4f0395a99&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 247ms
 GET /sw.js 404 in 73ms
 GET /products/prod_jwl_004/edit 200 in 51ms
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2 AND "public"."categories"."parentId" IS NULL) ORDER BY "public"."categories"."parentId" ASC, "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."isActive" = $1 AND "public"."categories"."parentId" IN ($2)) ORDER BY "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 GET /api/categories 200 in 266ms
 GET /api/settings 200 in 266ms
 GET /api/products/prod_jwl_004 200 in 260ms
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $2
Product update request for ID: prod_jwl_004
Received images: []
Received videos: []
Received thumbnailUrl: null
prisma:query SELECT 1
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
Received update data: {
  images: [],
  videos: [],
  thumbnailUrl: null,
  imagesCount: 0,
  videosCount: 0,
  imagesDetails: [],
  videosDetails: []
}
Update data after filtering: {
  categoryIds: [],
  clientId: undefined,
  restUpdateDataKeys: [
    'name',        'sku',
    'description', 'price',
    'category',    'stockLevel',
    'minStock',    'isActive',
    'variations',  'images',
    'videos',      'thumbnailUrl',
    'updatedAt'
  ],
  restUpdateData: {
    name: 'Pearl Bracelet',
    sku: 'JWL-004',
    description: 'Classic pearl bracelet for special occasions',
    price: '149.99',
    category: 'Jewelry',
    stockLevel: 8,
    minStock: 2,
    isActive: true,
    variations: [],
    images: [],
    videos: [],
    thumbnailUrl: null,
    updatedAt: 2025-09-24T13:11:52.744Z
  }
}
prisma:query BEGIN
prisma:query UPDATE "public"."products" SET "name" = $1, "sku" = $2, "description" = $3, "price" = $4, "category" = $5, "stockLevel" = $6, "minStock" = $7, "isActive" = $8, "variations" = $9, "images" = $10, "videos" = $11, "thumbnailUrl" = $12, "updatedAt" = $13 WHERE ("public"."products"."id" = $14 AND 1=1) RETURNING "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt"
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId" FROM "public"."product_categories" WHERE (1=1 AND "public"."product_categories"."productId" IN ($1)) OFFSET $2
prisma:query SELECT "public"."media"."id", "public"."media"."productId" FROM "public"."media" WHERE (1=1 AND "public"."media"."productId" IN ($1)) OFFSET $2
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE "public"."products"."id" = $1 LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC LIMIT $2 OFFSET $3
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query COMMIT
Product updated successfully: {
  id: 'prod_jwl_004',
  imagesCount: 0,
  videosCount: 0,
  thumbnailUrl: null,
  imagesDetails: [],
  videosDetails: []
}
 PUT /api/products/prod_jwl_004 200 in 287ms
 GET /products 200 in 52ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2 AND "public"."categories"."parentId" IS NULL) ORDER BY "public"."categories"."parentId" ASC, "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."isActive" = $1 AND "public"."categories"."parentId" IN ($2)) ORDER BY "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
 GET /api/categories 200 in 269ms
 GET /api/settings 200 in 270ms
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131154Z&X-Amz-Expires=604800&X-Amz-Signature=5d7535e41052c221cf6d060d3bf2fb1287e06abb5f94d9b754853ae8ff3a6e0e&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131154Z&X-Amz-Expires=604800&X-Amz-Signature=41402643d0d7d72cca75cc081c03c4df065a3157f26dd2aee704c4c1d72c88b5&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 283ms
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
 GET /api/settings 200 in 287ms
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
 GET /api/categories 200 in 289ms
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2 AND "public"."categories"."parentId" IS NULL) ORDER BY "public"."categories"."parentId" ASC, "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."isActive" = $1 AND "public"."categories"."parentId" IN ($2)) ORDER BY "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131154Z&X-Amz-Expires=604800&X-Amz-Signature=5d7535e41052c221cf6d060d3bf2fb1287e06abb5f94d9b754853ae8ff3a6e0e&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131154Z&X-Amz-Expires=604800&X-Amz-Signature=41402643d0d7d72cca75cc081c03c4df065a3157f26dd2aee704c4c1d72c88b5&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 296ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131155Z&X-Amz-Expires=604800&X-Amz-Signature=766c3d955642db1bdcb3c3c0198cdc1871276cd388e3cd24f13252647f785375&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131155Z&X-Amz-Expires=604800&X-Amz-Signature=113cde3bf6ec18bfa73689b4001ab27d02e9f44726b54101bcfb2264b7c2a0a3&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 245ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131155Z&X-Amz-Expires=604800&X-Amz-Signature=766c3d955642db1bdcb3c3c0198cdc1871276cd388e3cd24f13252647f785375&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131155Z&X-Amz-Expires=604800&X-Amz-Signature=113cde3bf6ec18bfa73689b4001ab27d02e9f44726b54101bcfb2264b7c2a0a3&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 279ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131155Z&X-Amz-Expires=604800&X-Amz-Signature=766c3d955642db1bdcb3c3c0198cdc1871276cd388e3cd24f13252647f785375&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131155Z&X-Amz-Expires=604800&X-Amz-Signature=113cde3bf6ec18bfa73689b4001ab27d02e9f44726b54101bcfb2264b7c2a0a3&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 267ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_001',
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_001',
    sku: 'JWL-001',
    mediaCount: 0,
    media: [],
    images: null,
    videos: null,
    thumbnailUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131155Z&X-Amz-Expires=604800&X-Amz-Signature=766c3d955642db1bdcb3c3c0198cdc1871276cd388e3cd24f13252647f785375&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T131155Z&X-Amz-Expires=604800&X-Amz-Signature=113cde3bf6ec18bfa73689b4001ab27d02e9f44726b54101bcfb2264b7c2a0a3&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=400&fit=crop&crop=center'
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 244ms
 GET /products/prod_jwl_002 200 in 69ms
prisma:query SELECT 1
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 GET /api/settings 200 in 256ms
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $2
 GET /api/products/prod_jwl_002 200 in 255ms
 GET /products/prod_jwl_002/edit 200 in 64ms
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2 AND "public"."categories"."parentId" IS NULL) ORDER BY "public"."categories"."parentId" ASC, "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."isActive" = $1 AND "public"."categories"."parentId" IN ($2)) ORDER BY "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $2
 GET /api/categories 200 in 263ms
 GET /api/products/prod_jwl_002 200 in 262ms
 GET /api/settings 200 in 266ms
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
 ✓ Compiled in 146ms
 GET /products 200 in 61ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2 AND "public"."categories"."parentId" IS NULL) ORDER BY "public"."categories"."parentId" ASC, "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."isActive" = $1 AND "public"."categories"."parentId" IN ($2)) ORDER BY "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
 GET /api/categories 200 in 274ms
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003',
  'prod_jwl_001'
]
 GET /api/settings 200 in 280ms
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_004',
    sku: 'JWL-004',
    mediaCount: 0,
    media: [],
    images: [],
    videos: [],
    thumbnailUrl: null
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T133017Z&X-Amz-Expires=604800&X-Amz-Signature=caf84341401421f71672eaf634f8625cfb67f64486c167660149c585749ea19f&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T133017Z&X-Amz-Expires=604800&X-Amz-Signature=ff6da7e0d49970d2d076c7715fa2a1591ad387521df5e5b9b3d3828276fc3eee&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: null
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 290ms
prisma:query SELECT "public"."client_settings"."id", "public"."client_settings"."clientId", "public"."client_settings"."companyName", "public"."client_settings"."email", "public"."client_settings"."phone", "public"."client_settings"."address", "public"."client_settings"."timezone", "public"."client_settings"."lowStockThreshold", "public"."client_settings"."autoReorder", "public"."client_settings"."emailNotifications", "public"."client_settings"."smsNotifications", "public"."client_settings"."createdAt", "public"."client_settings"."updatedAt" FROM "public"."client_settings" WHERE ("public"."client_settings"."clientId" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."clients"."id", "public"."clients"."name", "public"."clients"."slug", "public"."clients"."domain", "public"."clients"."email", "public"."clients"."phone", "public"."clients"."address", "public"."clients"."logo", "public"."clients"."countryId", "public"."clients"."currencyId", "public"."clients"."isActive", "public"."clients"."plan"::text, "public"."clients"."createdAt", "public"."clients"."updatedAt" FROM "public"."clients" WHERE "public"."clients"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."clientId" = $1 AND "public"."categories"."isActive" = $2 AND "public"."categories"."parentId" IS NULL) ORDER BY "public"."categories"."parentId" ASC, "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId", "public"."categories"."sortOrder", "public"."categories"."createdAt", "public"."categories"."clientId" FROM "public"."categories" WHERE ("public"."categories"."isActive" = $1 AND "public"."categories"."parentId" IN ($2)) ORDER BY "public"."categories"."sortOrder" ASC, "public"."categories"."name" ASC OFFSET $3
 GET /api/settings 200 in 319ms
 GET /api/categories 200 in 322ms
Fetching media for product IDs: [
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003',
  'prod_jwl_001'
]
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_004',
    sku: 'JWL-004',
    mediaCount: 0,
    media: [],
    images: [],
    videos: [],
    thumbnailUrl: null
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T133017Z&X-Amz-Expires=604800&X-Amz-Signature=caf84341401421f71672eaf634f8625cfb67f64486c167660149c585749ea19f&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T133017Z&X-Amz-Expires=604800&X-Amz-Signature=ff6da7e0d49970d2d076c7715fa2a1591ad387521df5e5b9b3d3828276fc3eee&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: null
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 347ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003',
  'prod_jwl_001'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_004',
    sku: 'JWL-004',
    mediaCount: 0,
    media: [],
    images: [],
    videos: [],
    thumbnailUrl: null
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T133017Z&X-Amz-Expires=604800&X-Amz-Signature=caf84341401421f71672eaf634f8625cfb67f64486c167660149c585749ea19f&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T133017Z&X-Amz-Expires=604800&X-Amz-Signature=ff6da7e0d49970d2d076c7715fa2a1591ad387521df5e5b9b3d3828276fc3eee&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: null
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 267ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003',
  'prod_jwl_001'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_004',
    sku: 'JWL-004',
    mediaCount: 0,
    media: [],
    images: [],
    videos: [],
    thumbnailUrl: null
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T133018Z&X-Amz-Expires=604800&X-Amz-Signature=fb0de166cc17f92fafbe9d233865afa27af410d32280e66f148913a66463e5cb&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T133018Z&X-Amz-Expires=604800&X-Amz-Signature=5e71ec1d9a5b1eb20adc91a735a85ee9a2a3dd605391da5abe3e0f20e13ed094&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: null
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 247ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003',
  'prod_jwl_001'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_004',
    sku: 'JWL-004',
    mediaCount: 0,
    media: [],
    images: [],
    videos: [],
    thumbnailUrl: null
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T133018Z&X-Amz-Expires=604800&X-Amz-Signature=fb0de166cc17f92fafbe9d233865afa27af410d32280e66f148913a66463e5cb&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T133018Z&X-Amz-Expires=604800&X-Amz-Signature=5e71ec1d9a5b1eb20adc91a735a85ee9a2a3dd605391da5abe3e0f20e13ed094&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: null
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 260ms
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."products"."id" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) OFFSET $3) AS "sub"
prisma:query SELECT "public"."products"."id", "public"."products"."name", "public"."products"."sku", "public"."products"."description", "public"."products"."price", "public"."products"."category", "public"."products"."categoryId", "public"."products"."variations", "public"."products"."stockLevel", "public"."products"."minStock", "public"."products"."isActive", "public"."products"."clientId", "public"."products"."media", "public"."products"."images", "public"."products"."videos", "public"."products"."thumbnailUrl", "public"."products"."createdAt", "public"."products"."updatedAt" FROM "public"."products" WHERE ("public"."products"."clientId" = $1 AND "public"."products"."isActive" = $2) ORDER BY "public"."products"."name" ASC LIMIT $3 OFFSET $4
prisma:query SELECT "public"."product_categories"."id", "public"."product_categories"."productId", "public"."product_categories"."categoryId", "public"."product_categories"."createdAt" FROM "public"."product_categories" WHERE "public"."product_categories"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
prisma:query SELECT "public"."categories"."id", "public"."categories"."name", "public"."categories"."description", "public"."categories"."parentId" FROM "public"."categories" WHERE "public"."categories"."id" IN ($1) OFFSET $2
prisma:query SELECT "public"."inventory_history"."id", "public"."inventory_history"."productId", "public"."inventory_history"."quantity", "public"."inventory_history"."type"::text, "public"."inventory_history"."reason", "public"."inventory_history"."userId", "public"."inventory_history"."clientId", "public"."inventory_history"."createdAt" FROM "public"."inventory_history" WHERE "public"."inventory_history"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) ORDER BY "public"."inventory_history"."createdAt" DESC OFFSET $9
prisma:query SELECT "public"."media"."id", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt", "public"."media"."productId" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Fetching media for product IDs: [
  'prod_jwl_004',
  'cmfxz3ql30007y7o5p5h8ekuv',
  'prod_jwl_002',
  'cmfxyus250001y7xp90f7vztj',
  'cmftrc2660001y709bx9xr40s',
  'cmfvxu76x0001y7wdx27ki5dd',
  'prod_jwl_003',
  'prod_jwl_001'
]
prisma:query SELECT "public"."media"."id", "public"."media"."productId", "public"."media"."kind", "public"."media"."s3Key", "public"."media"."width", "public"."media"."height", "public"."media"."durationMs", "public"."media"."status", "public"."media"."error", "public"."media"."createdAt", "public"."media"."updatedAt" FROM "public"."media" WHERE "public"."media"."productId" IN ($1,$2,$3,$4,$5,$6,$7,$8) OFFSET $9
Raw media data from database: {
  mediaCount: 2,
  mediaData: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4'
    },
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key'
    }
  ]
}
Media grouped by product: {
  cmfxyus250001y7xp90f7vztj: [
    {
      id: 'cmfxyzw960005y7o579trdpwz',
      productId: 'cmfxyus250001y7xp90f7vztj',
      kind: 'video',
      s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'completed',
      error: null,
      createdAt: 2025-09-24T12:38:30.667Z,
      updatedAt: 2025-09-24T12:38:30.667Z
    }
  ],
  cmfxz3ql30007y7o5p5h8ekuv: [
    {
      id: 'cmfxz5g1z000ey7o5yunkv14r',
      productId: 'cmfxz3ql30007y7o5p5h8ekuv',
      kind: 'image',
      s3Key: 'test-image-key',
      width: 0,
      height: 0,
      durationMs: null,
      status: 'failed',
      error: 'Failed to fetch image: Forbidden',
      createdAt: 2025-09-24T12:42:49.607Z,
      updatedAt: 2025-09-24T12:42:49.863Z
    }
  ]
}
Products with media attached: {
  productCount: 8,
  firstProduct: {
    id: 'prod_jwl_004',
    sku: 'JWL-004',
    mediaCount: 0,
    media: [],
    images: [],
    videos: [],
    thumbnailUrl: null
  }
}
Processing products for media URLs: { productCount: 8, productsWithMedia: 2, firstProductMedia: [] }
processMediaWithUrls called with: { productCount: 8, productsWithMedia: 2, productsWithLegacyImages: 1 }
Processing product: {
  sku: 'JWL-004',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'SCHEMA-TEST-001',
  hasMedia: true,
  hasLegacyImages: true,
  mediaCount: 1,
  legacyImageCount: 1
}
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-002',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'TEST-E2E-001',
  hasMedia: true,
  hasLegacyImages: false,
  mediaCount: 1,
  legacyImageCount: 0
}
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-49547',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-49547 : [
  {
    id: '17584627706718wmywk34p',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=72bd2d06efc053c8053bb94c49c9857e1aa9f604faf7ec049fe76323dea42fbc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-21T13:52:56.285Z',
    thumbnailUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/image/1758462772577-hvymwhf5y06.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250921%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T135252Z&X-Amz-Expires=604800&X-Amz-Signature=28f3ac504460eb5a9b4722c6c3e1d75281e4ce26ee2fc7f7dc6f4417d99739ff&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject'
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'VFJ-21476',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing legacy videos for VFJ-21476 : [
  {
    id: '1758594611268457f2f83q',
    key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    url: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
    fileName: 'pearl-video.mp4',
    fileSize: 8384183,
    fileType: 'video/mp4',
    uploadedAt: '2025-09-23T02:30:32.562Z',
    thumbnailUrl: null
  }
]
Generating signed URL for: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Processing product: {
  sku: 'JWL-003',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Processing product: {
  sku: 'JWL-001',
  hasMedia: false,
  hasLegacyImages: false,
  mediaCount: 0,
  legacyImageCount: 0
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL successfully: {
  key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T133018Z&X-Amz-Expires=604800&X-Amz-Signature=fb0de166cc17f92fafbe9d233865afa27af410d32280e66f148913a66463e5cb&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for new media: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/test-e2e-001/media/video/1758717461567-n14bhn01nrj.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIASIKAMCT4EZQVQVXJ%2F20250924%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250924T133018Z&X-Amz-Expires=604800&X-Amz-Signature=5e71ec1d9a5b1eb20adc91a735a85ee9a2a3dd605391da5abe3e0f20e13ed094&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject',
  isSigned: true,
  hasSignature: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-49547/media/video/1758462771670-zoy7v44ecuq.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Generated signed URL for legacy video: {
  s3Key: 'clients/cmfohvqxb0001jp04hqvisj49/products/vfj-21476/media/video/1758594611559-na0a2zioi2.mp4',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/clients/cmfohvqxb0001jp04hqvisj49/products/vfj-...',
  isSigned: true
}
Processing legacy images for SCHEMA-TEST-001 : [
  {
    id: 'test-image-1',
    key: 'test-image-key',
    url: 'https://example.com/test-image.jpg',
    fileName: 'test-image.jpg',
    fileSize: 1024,
    fileType: 'image/jpeg',
    uploadedAt: '2025-09-24T12:41:00.000Z'
  }
]
Generating signed URL for: {
  key: 'test-image-key',
  expiresIn: 604800,
  region: undefined,
  bucket: 'quick-stock-media',
  hasAccessKey: true,
  hasSecretKey: true
}
Generated signed URL successfully: {
  key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  hasSignature: true
}
Generated signed URL for legacy image: {
  s3Key: 'test-image-key',
  signedUrl: 'https://quick-stock-media.s3.us-east-2.amazonaws.com/test-image-key?X-Amz-Algorithm=AWS4-HMAC-SHA256...',
  isSigned: true
}
Processed products: {
  processedCount: 8,
  firstProcessedMedia: [],
  firstProductImages: [],
  firstProductVideos: [],
  firstProductThumbnail: null
}
 GET /api/products?page=1&limit=12&search=&category=&sortBy=name&sortOrder=asc 200 in 251ms
 GET / 200 in 125ms
 GET /sw.js 404 in 67ms
